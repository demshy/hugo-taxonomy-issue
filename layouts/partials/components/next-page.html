{{ $cld := .Site.Params.cldUrl }}
{{ $transform := .Site.Params.cldTransform }}

<div class="next-page container" data-link="{{ .RelPermalink }}">
  <div class="grid no-row-gap">
    <a href="" class="col-12 col-md-11 offset-md-1 col-xl-10 offset-xl-2">
      {{ if in .Params.image $cld }}
        {{ $relSrc := replace .Params.image $cld "" }}
        <img
          data-srcset="
            {{ $cld }}h_320,w_1540,{{ $transform }}/{{ $relSrc }} 1540w,
            {{ $cld }}h_320,w_1044,{{ $transform }}/{{ $relSrc }} 1044w,
            {{ $cld }}h_280,w_728,{{ $transform }}/{{ $relSrc }} 728w
          "
          sizes="
            (max-width: 768px) 728px,
            (max-width: 1200px) 1044px,
            1540px
          "
          data-src="{{ $cld }}h_320,w_1044,{{ $transform }}/{{ $relSrc }}"
          class="next-page__image lazyload"
          alt="{{ .Title }}"
          width="1000"
          height="320">
      {{ else }}
        <img data-src="{{ .Params.image }}" alt="" width="1000" height="320" class="next-page__image lazyload">
      {{ end }}
    </a>

    <div class="col-12 col-md-11 offset-md-1 col-xl-9 offset-xl-2 col-xxl-8 next-page__text">
      <div>
        <a href="" class="h2">
          <span>{{ T "next" }}</span>
          {{ .Title }}
        </a>
        <p class="no-margin">{{ .Description }}</p>
      </div>

      {{ partial "components/arrow-button" (dict
        "text" (T "discover-more")
        "href" ""
      ) }}
    </div>
  </div>
</div>

<script>
// inline script exception: this is a specific situation because hrefs need to be added by reading the actual (rewrite) URL, which Hugo can't do.

(function(){
  const nextPageEl = document.querySelector('.next-page')
  const aEls = nextPageEl.querySelectorAll('a')
  const slug = nextPageEl.dataset.link.split('/')[2]
  const url = window.location.pathname.replace(/\/$/, '').split('/').slice(0, -1).join('/')
  console.log(url)
  aEls.forEach(aEl => { aEl.href = `${url}/${slug}/` })
})()
</script>
